<link rel="import" href="bower_components/polymer/polymer.html">
<link rel="import" href="bower_components/font-roboto/roboto.html">
<link rel="import" href="wrabble-board.html">
<polymer-element name="wrabble-game">
  <template>
    <style>
      :host {
        display: block;
        font-family: 'RobotoDraft', sans-serif;
      }
      wrabble-board {
        margin-bottom: 10px;
      }
      @media screen and (max-height: 640px) {
        wrabble-board {
          height: 300px;
        }
      }
      .curr.word {
        display: block;
        height: 45px;
        font-size: 35px;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }
      .word.valid {
        color: #259b24;
      }
      .word.invalid {
        color: #e51c23;
      }
      .word.unverified {
        color: #ff9800;
      }
    </style>
    <div class="curr word">{{currWord}}</div>
    <wrabble-board id="board" 
      word="{{currWord}}" 
      on-new-word="{{onNewWord}}">
    </wrabble-board>
    <div>Total: {{total.words}} words, score: {{total.score}}</div>
    <template if="{{best}}">
      <div>Best: {{best.word}} - {{best.length}}/{{best.score}}</div>
    </template>
    <ul class="wordslist">
      <template repeat="{{w in words}}">
        <li class="{{w.status}} word">
          {{w.word}} - {{w.length}}/{{w.score}}
        </li>
      </template>
    </ul>
  </template>
  <script>
    Polymer({
      words: [],
      best: null,
      total: {
        words: 0,
        length: 0,
        score: 0
      },
      onNewWord: function(e, details) {
        var w = details.word;
        if (w && w.length > 2) {
          var word = {
            word: w,
            length: w.length,
            score: 0,
            status: 'unverified'
          };
          this.words.unshift(word);
          this.async(this.validate, [word]);
        }
      },
      validate: function(w) {
        w.score = this.wordScore(w.word);
        w.status = 'valid';
        if (w.status === 'valid') {
          this.total['words']++;
          this.total['length'] += w.length;
          this.total['score'] += w.score;
          this.updateBestWord();
        }
      },
      updateBestWord: function() {
        var score = this.best && this.best.score + this.best.length || 0;
        for (var i = 0, w; w = this.words[i]; i++) {
          if (w.score + w.length > score) {
            this.best = w;
          }
        };
      },
      wordScore: function(word) {
        var len = word && word.length || 0;
        if (len < 3) return 0;
        switch (len) {
          case 3:
          case 4:
            return 1;
          case 5:
            return 2;
          case 6:
            return 3;
          case 7:
            return 5;
          default:
            return 11
        }
      }
    });
  </script>
</polymer-element>
